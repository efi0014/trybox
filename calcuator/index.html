<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全功能网页计算器 (带主题切换)</title>

    <!-- 1. 优化后的 CSS 样式 (含明暗模式) -->
    <style>
        :root {
            --primary-color: #007aff;
            --bg-color: #f0f2f5;
            --surface-color: #ffffff;
            --text-color: #2c2c2e;
            --secondary-text-color: #6d6d72;
            --border-color: #e5e5ea;
            --operator-bg: #f0f0f0;
            --operator-hover-bg: #e0e0e0;
            --special-bg: #ff9500;
            --special-hover-bg: #fb8c00;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --theme-toggle-bg: #e5e5ea;
        }

        body.dark-mode {
            --primary-color: #0a84ff;
            --bg-color: #1c1c1e;
            --surface-color: #2c2c2e;
            --text-color: #f5f5f7;
            --secondary-text-color: #8e8e93;
            --border-color: #3a3a3c;
            --operator-bg: #3a3a3c;
            --operator-hover-bg: #4a4a4c;
            --special-bg: #ff9f0a;
            --special-hover-bg: #ff9500;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --theme-toggle-bg: #3a3a3c;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
        }

        .main-container {
            width: 100%;
            max-width: 480px;
            background: var(--surface-color);
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow-color);
            padding: 25px;
            overflow: hidden;
            position: relative;
        }
        
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 25px;
        }

        h1 {
            margin: 0;
            text-align: center;
            color: var(--text-color);
            font-size: 1.8rem;
        }
        
        #theme-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--theme-toggle-bg);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            outline: none;
        }

        #theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-color);
        }

        /* Tabs and other styles remain largely the same, but use CSS variables */
        .tabs { display: flex; margin-bottom: 25px; background: var(--bg-color); border-radius: 10px; padding: 4px; }
        .tab-link { flex: 1; background: transparent; border: none; outline: none; cursor: pointer; padding: 10px; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; color: var(--secondary-text-color); border-radius: 8px; }
        .tab-link.active { background-color: var(--surface-color); color: var(--primary-color); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); }
        .tab-content { display: none; padding: 5px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .display input { width: 100%; height: 80px; font-size: 3.5rem; text-align: right; border: none; border-radius: 10px; padding: 15px; background-color: var(--bg-color); color: var(--text-color); margin-bottom: 20px; font-weight: 300; }
        .buttons { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; }
        .buttons button { height: 65px; font-size: 1.5rem; border: none; border-radius: 12px; cursor: pointer; background: var(--operator-bg); color: var(--text-color); transition: all 0.15s ease; }
        .buttons button:active { transform: scale(0.95); }
        .buttons .num-key { background-color: var(--operator-bg); font-weight: 500; }
        .buttons .op-key { color: var(--primary-color); font-weight: 500; }
        .buttons .sp-key { background: var(--special-bg); color: white; }
        .buttons .sp-key:hover { background: var(--special-hover-bg); }
        .buttons .equals { grid-column: span 2; background: var(--primary-color); color: white; }
        .buttons .zero { grid-column: span 2; }
        .calc-tip { margin-top: 15px; padding: 10px; background: var(--bg-color); border-radius: 8px; font-size: 0.9rem; color: var(--secondary-text-color); }
        .calc-tip strong { color: var(--text-color); }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--secondary-text-color); }
        .form-group input, .form-group select { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-color); color: var(--text-color); }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15); }
        
        #equation-result { margin-top: 20px; padding: 15px; font-size: 1.2rem; font-weight: 500; color: var(--primary-color); background-color: var(--bg-color); border-radius: 8px; text-align: center; min-height: 50px; }
        #plot-container { width: 100%; height: 300px; margin-top: 20px; }
        .converter-io { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; }
        .converter-io span { font-size: 1.8rem; font-weight: 500; color: var(--secondary-text-color); text-align: center; }
        
        .action-button { width: 100%; padding: 14px; font-size: 1.1rem; font-weight: 500; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; cursor: pointer; }
        
        @media (max-width: 480px) { body { padding: 0; align-items: flex-start; } .main-container { border-radius: 0; min-height: 100vh; box-shadow: none; } .tabs { flex-wrap: wrap; } .tab-link { font-size: 0.9rem; flex-basis: 50%; } .display input { font-size: 2.8rem; height: 70px; } .buttons { gap: 8px; } .buttons button { height: 60px; font-size: 1.3rem; } }
    </style>
</head>
<body>
    <!-- 关键: 用于防止主题闪烁的脚本 -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            }
        })();
    </script>

    <!-- 2. HTML 页面结构 -->
    <div class="main-container">
        <div class="header">
            <h1>全功能计算器</h1>
            <button id="theme-toggle" onclick="toggleTheme()" aria-label="切换主题">
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L5.64 5.64zm12.73 12.73c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.06-1.06zm1.06-10.61c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.06-1.06z"/></svg>
                <svg id="moon-icon" style="display:none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.3 4.9c.4-.2.6-.7.4-1.1-.2-.4-.7-.6-1.1-.4C7.2 5.4 4 9.2 4 13.5 4 19.1 8.9 24 14.5 24c4.3 0 8.1-3.2 10.1-7.6.2-.4 0-.9-.4-1.1-.4-.2-.9 0-1.1.4-1.7 3.6-5.1 6.2-9.1 6.2-4.5 0-8.2-3.7-8.2-8.2 0-3.5 2.2-6.5 5.3-7.6z"/></svg>
            </button>
        </div>
        <!-- 其余 HTML 结构保持不变 -->
        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'Calculator')">科学计算</button>
            <button class="tab-link" onclick="openTab(event, 'EquationSolver')">方程求解</button>
            <button class="tab-link" onclick="openTab(event, 'Grapher')">函数图像</button>
            <button class="tab-link" onclick="openTab(event, 'Converter')">单位换算</button>
        </div>
        <div id="Calculator" class="tab-content"> <div class="calculator"> <div class="display"> <input type="text" id="calc-display" readonly> </div> <div class="buttons"> <button onclick="appendToDisplay('(')" class="op-key">(</button> <button onclick="appendToDisplay(')')" class="op-key">)</button> <button onclick="appendToDisplay('Math.sin(')" class="op-key">sin</button> <button onclick="appendToDisplay('Math.cos(')" class="op-key">cos</button> <button onclick="appendToDisplay('Math.tan(')" class="op-key">tan</button> <button onclick="appendToDisplay('**')" class="op-key">xʸ</button> <button onclick="appendToDisplay('**(1/')" class="op-key">ʸ√x</button> <button onclick="appendToDisplay('Math.log10(')" class="op-key">log</button> <button onclick="appendToDisplay('Math.log(')" class="op-key">ln</button> <button onclick="clearDisplay()" class="sp-key">C</button> <button onclick="appendToDisplay('7')" class="num-key">7</button> <button onclick="appendToDisplay('8')" class="num-key">8</button> <button onclick="appendToDisplay('9')" class="num-key">9</button> <button onclick="deleteLast()" class="sp-key">DEL</button> <button onclick="appendToDisplay('/')" class="sp-key">÷</button> <button onclick="appendToDisplay('4')" class="num-key">4</button> <button onclick="appendToDisplay('5')" class="num-key">5</button> <button onclick="appendToDisplay('6')" class="num-key">6</button> <button onclick="appendToDisplay('*')" class="sp-key">×</button> <button onclick="appendToDisplay('-')" class="sp-key">−</button> <button onclick="appendToDisplay('1')" class="num-key">1</button> <button onclick="appendToDisplay('2')" class="num-key">2</button> <button onclick="appendToDisplay('3')" class="num-key">3</button> <button onclick="appendToDisplay('+')" class="sp-key">+</button> <button onclick="appendToDisplay('Math.sqrt(')" class="op-key">√</button> <button onclick="appendToDisplay('0')" class="num-key zero">0</button> <button onclick="appendToDisplay('.')" class="num-key">.</button> <button onclick="calculateResult()" class="equals">=</button> </div> <div class="calc-tip"> <strong>提示:</strong> 开多次方根(ʸ√x)，请先输入被开方数x，按 ʸ√x，再输入次数y，并补全右括号 `)`. 例如: `27**(1/3)`。 </div> </div> </div>
        <div id="EquationSolver" class="tab-content"> <h2>二次方程求解 (ax² + bx + c = 0)</h2> <div class="form-group"> <label for="coeff-a">系数 a (不能为0)</label> <input type="number" id="coeff-a" placeholder="例如: 1"> </div> <div class="form-group"> <label for="coeff-b">系数 b</label> <input type="number" id="coeff-b" placeholder="例如: -5"> </div> <div class="form-group"> <label for="coeff-c">系数 c</label> <input type="number" id="coeff-c" placeholder="例如: 6"> </div> <button onclick="solveQuadraticEquation()" class="action-button">求解</button> <p id="equation-result"></p> </div>
        <div id="Grapher" class="tab-content"> <h2>函数图像绘制</h2> <div class="form-group"> <label for="function-input">输入函数 f(x)</label> <input type="text" id="function-input" value="sin(x)" placeholder="例如: x**2 或 tan(x)"> </div> <button onclick="plotFunction()" class="action-button">绘制图像</button> <div id="plot-container"></div> </div>
        <div id="Converter" class="tab-content"> <h2>单位换算</h2> <div class="form-group"> <label for="unit-category">选择类别</label> <select id="unit-category" onchange="updateUnitOptions()"></select> </div> <div class="converter-io"> <div> <input type="number" id="input-value" oninput="convertUnits()" placeholder="输入值"> <select id="from-unit" onchange="convertUnits()"></select> </div> <span>→</span> <div> <input type="text" id="output-value" readonly> <select id="to-unit" onchange="convertUnits()"></select> </div> </div> </div>
    </div>

    <!-- 外部函数绘图库 -->
    <script src="https://unpkg.com/function-plot/dist/function-plot.js"></script>

    <!-- 3. JavaScript 核心逻辑 (含主题切换) -->
    <script>
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');

        // 初始化页面时设置正确的图标
        function setInitialThemeIcon() {
            if (document.body.classList.contains('dark-mode')) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        // 切换主题的函数
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            let theme = 'light';
            if (document.body.classList.contains('dark-mode')) {
                theme = 'dark';
            }
            localStorage.setItem('theme', theme);
            setInitialThemeIcon(); // 更新图标显示
        }

        // --- 页面加载完成后的初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            setInitialThemeIcon();
            document.querySelector('.tab-link').click();
            initializeUnitConverter();
            plotFunction(); 
        });

        // --- 其余的 JS 逻辑保持不变 ---
        function openTab(evt, tabName) { const tabContents = document.getElementsByClassName('tab-content'); for (let i = 0; i < tabContents.length; i++) { tabContents[i].style.display = 'none'; } const tabLinks = document.getElementsByClassName('tab-link'); for (let i = 0; i < tabLinks.length; i++) { tabLinks[i].className = tabLinks[i].className.replace(' active', ''); } document.getElementById(tabName).style.display = 'block'; evt.currentTarget.className += ' active'; }
        const display = document.getElementById('calc-display'); function appendToDisplay(value) { display.value += value; } function clearDisplay() { display.value = ''; } function deleteLast() { display.value = display.value.slice(0, -1); } function calculateResult() { try { const result = new Function('return ' + display.value)(); display.value = Number.isFinite(result) ? parseFloat(result.toPrecision(12)) : '错误'; } catch (error) { display.value = '表达式错误'; } }
        function solveQuadraticEquation() { const a = parseFloat(document.getElementById('coeff-a').value); const b = parseFloat(document.getElementById('coeff-b').value); const c = parseFloat(document.getElementById('coeff-c').value); const resultElement = document.getElementById('equation-result'); if (isNaN(a) || isNaN(b) || isNaN(c)) { resultElement.textContent = '请输入有效的 a, b, c 值。'; return; } if (a === 0) { resultElement.textContent = '系数 a 不能为 0。'; return; } const discriminant = b * b - 4 * a * c; let solution; if (discriminant > 0) { const x1 = (-b + Math.sqrt(discriminant)) / (2 * a); const x2 = (-b - Math.sqrt(discriminant)) / (2 * a); solution = `解为: x₁ = ${parseFloat(x1.toPrecision(6))}, x₂ = ${parseFloat(x2.toPrecision(6))}`; } else if (discriminant === 0) { const x = -b / (2 * a); solution = `方程有唯一解: x = ${parseFloat(x.toPrecision(6))}`; } else { const realPart = (-b / (2 * a)); const imagPart = (Math.sqrt(-discriminant) / (2 * a)); solution = `解为: x₁ = ${parseFloat(realPart.toPrecision(6))} + ${parseFloat(imagPart.toPrecision(6))}i, x₂ = ${parseFloat(realPart.toPrecision(6))} - ${parseFloat(imagPart.toPrecision(6))}i`; } resultElement.textContent = solution; }
        function plotFunction() { try { functionPlot({ target: '#plot-container', data: [{ fn: document.getElementById('function-input').value || "0", sampler: 'builtIn', graphType: 'polyline' }], grid: true, }); } catch (err) { alert("函数表达式无效: " + err); } }
        const units = { 长度: { 米: 1, 千米: 1000, 厘米: 0.01, 毫米: 0.001, 英里: 1609.34, 码: 0.9144, 英尺: 0.3048, 英寸: 0.0254, }, 质量: { 克: 1, 千克: 1000, 毫克: 0.001, 吨: 1000000, 磅: 453.592, 盎司: 28.3495, }, 温度: { 摄氏度: { toBase: c => c + 273.15, fromBase: k => k - 273.15 }, 华氏度: { toBase: f => (f - 32) * 5/9 + 273.15, fromBase: k => (k - 273.15) * 9/5 + 32 }, 开尔文: { toBase: k => k, fromBase: k => k }, } };
        function initializeUnitConverter() { const categorySelect = document.getElementById('unit-category'); for (const category in units) { categorySelect.add(new Option(category, category)); } updateUnitOptions(); }
        function updateUnitOptions() { const category = document.getElementById('unit-category').value; const fromUnitSelect = document.getElementById('from-unit'); const toUnitSelect = document.getElementById('to-unit'); fromUnitSelect.innerHTML = ''; toUnitSelect.innerHTML = ''; const unitOptions = Object.keys(units[category]); unitOptions.forEach(unit => { fromUnitSelect.add(new Option(unit, unit)); toUnitSelect.add(new Option(unit, unit)); }); if (unitOptions.length > 1) { toUnitSelect.selectedIndex = 1; } convertUnits(); }
        function convertUnits() { const inputValue = parseFloat(document.getElementById('input-value').value); const outputField = document.getElementById('output-value'); if (isNaN(inputValue)) { outputField.value = ''; return; } const category = document.getElementById('unit-category').value; const fromUnit = document.getElementById('from-unit').value; const toUnit = document.getElementById('to-unit').value; let baseValue = (category === '温度') ? units[category][fromUnit].toBase(inputValue) : inputValue * units[category][fromUnit]; let outputValue = (category === '温度') ? units[category][toUnit].fromBase(baseValue) : baseValue / units[category][toUnit]; outputField.value = parseFloat(outputValue.toPrecision(12)); }
    </script>
</body>
</html>
